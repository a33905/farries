<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>再試一次 - 仙聲奪人</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        @keyframes subtle-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        .animate-subtle {
            animation: subtle-shake 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen flex flex-col items-center justify-center p-8 text-center">

    <div class="space-y-10 max-w-md w-full">
        <!-- 失敗訊息 -->
        <div class="space-y-4">
            <div class="inline-block p-4 bg-red-500/10 rounded-full mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
            </div>
            <h1 class="text-4xl font-black text-white tracking-wider">
                喔喔... 不是這個
            </h1>
            <p id="fail-desc" class="text-slate-500 tracking-widest font-light">剛才那個聲音聽起來不太對勁</p>
        </div>

        <!-- 播放剛才選錯的音檔按鈕 -->
        <div class="py-6">
            <p class="text-xs text-slate-600 uppercase tracking-[0.3em] mb-4">重新聆聽你選擇的聲音</p>
            <button id="replay-btn" class="w-24 h-24 bg-slate-800 border border-slate-700 rounded-full flex items-center justify-center shadow-xl active:scale-90 transition-all mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" class="text-slate-400 ml-1">
                    <path d="M5 3l14 9-14 9V3z"/>
                </svg>
            </button>
        </div>

        <!-- 返回按鈕 -->
        <div class="pt-10">
            <button onclick="window.location.href='index.html'" class="w-full py-5 rounded-2xl bg-slate-100 text-slate-900 font-bold text-lg tracking-widest shadow-lg active:scale-95 transition-all">
                返回重新挑戰
            </button>
            <p class="mt-6 text-slate-600 text-sm">小精靈正在重新打亂順序...</p>
        </div>
    </div>

<script>
        // 解析 URL 參數 (例如 index 傳過來的是 id=1_wrong)
        const urlParams = new URLSearchParams(window.location.search);
        const rawIdParam = urlParams.get('id') || '1_wrong'; 
        
        // 1. 自動播放用的音檔：例如 "1_wrong.mp3"
        const wrongAudio = new Audio(rawIdParam + '.mp3');
        
        // 2. 按鈕點擊播放用的音檔：從 "1_wrong" 提取出 "1"，變成 "1.mp3"
        const originalId = rawIdParam.replace('_wrong', '');
        const originalAudio = new Audio(originalId + '.mp3');
        
        const replayBtn = document.getElementById('replay-btn');
        const playIcon = document.getElementById('play-icon');

        /**
         * 更新按鈕圖示
         */
        function updateIcon(isPlaying) {
            if (isPlaying) {
                playIcon.innerHTML = `
                    <rect x="6" y="4" width="4" height="16"></rect>
                    <rect x="14" y="4" width="4" height="16"></rect>`;
                playIcon.classList.remove('ml-1');
            } else {
                playIcon.innerHTML = `<path d="M5 3l14 9-14 9V3z"/>`;
                playIcon.classList.add('ml-1');
            }
        }

        // 當頁面載入完成後：自動播放「錯誤提示音」(1_wrong.mp3)
        window.onload = () => {
            wrongAudio.play().catch(err => {
                console.log("自動播放錯誤提示音受阻。");
            });
        };

        // 按鈕點擊事件：播放「原始選擇音」(1.mp3)
        replayBtn.addEventListener('click', () => {
            // 如果錯誤提示音還在播，先停掉
            if (!wrongAudio.paused) {
                wrongAudio.pause();
                wrongAudio.currentTime = 0;
            }

            if (originalAudio.paused) {
                originalAudio.currentTime = 0;
                originalAudio.play();
                updateIcon(true);
            } else {
                originalAudio.pause();
                updateIcon(false);
            }
        });

        // 當原始選擇音播放結束時重置圖示
        originalAudio.onended = () => {
            updateIcon(false);
        };
    </script>
</body>
</html>
